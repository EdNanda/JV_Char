# -*- coding: utf-8 -*-
"""
Created on Thu Oct 13 11:33:24 2022

@author: HYDN02
"""
from pvlib import ivtools
import numpy as np

volt=[-0.20000000000000004, -0.15000000000000002, -0.10000000000000003, -0.050000000000000044, -5.551115123125783e-17, 0.04999999999999993, 0.09999999999999992, 0.1499999999999999, 0.19999999999999987, 0.2499999999999999, 0.2999999999999999, 0.3499999999999998, 0.39999999999999986, 0.4499999999999999, 0.49999999999999983, 0.5499999999999998, 0.5999999999999999, 0.6499999999999999, 0.6999999999999997, 0.7499999999999997, 0.7999999999999998]
curr=[-3.9016860000000006e-05, -3.713710333333333e-05, -3.557965666666667e-05, -3.426893666666667e-05, -3.314901666666667e-05, -3.220457666666667e-05, -3.137602333333334e-05, -3.067732333333333e-05, -3.013056e-05, -2.9655426666666665e-05, -2.9267916666666665e-05, -2.891248333333333e-05, -2.8547546666666666e-05, -2.8084480000000004e-05, -2.738094333333333e-05, -2.6153000000000002e-05, -2.3948756666666666e-05, -1.9888066666666667e-05, -1.20492e-05, 3.645658333333333e-06, 3.463109666666666e-05]

volt = np.array(volt)
curr = np.array(curr)

isc = curr[np.argmin(abs(volt))]

c0 = np.argmin(abs(volt))

volt[c0] = 0


c1 = sorted(abs(curr))[0]
c2 = sorted(abs(curr))[1]
i1 = np.where(abs(curr)==c1)[0][0]
i2 = np.where(abs(curr)==c2)[0][0]

v1 = volt[i1]
v2 = volt[i2]
m = (c2-c1)/(v2-v1)
b = c1-m*v1
voc = -b/m
# voc = 

volt[max(i1,i2)] = voc
curr[max(i1,i2)] = 0

s_curr = curr[c0:max(i1,i2)+1]
s_volt = volt[c0:max(i1,i2)+1]

mpp = np.argmax(-volt*curr)

mpp_v = volt[mpp]
mpp_c = curr[mpp]

ff = mpp_v*mpp_c/(voc*isc)
pin = 10#W/mÂ²
pce = voc*isc*ff/pin

print(voc, mpp_v,ff,pce)


# print(v1,voc,v2)

# ivtools.sde.fit_sandia_simple(s_volt,s_curr, vlim=0.2, ilim=0.1)